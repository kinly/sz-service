<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <include path="nodes.xml"/>

  <include path="animals/rat.xml"/>

  <BehaviorTree ID="root">
    <Sequence>
      <init.uuid data="{room_uuid}"/>
      <say.long msg="room.uuid"
                in="{room_uuid}"/>
      <get_stage room_uuid="{room_uuid}"
                 out="{stage}"/>
      <get_player_master room_uuid="{room_uuid}"
                         out="{master}"/>
      <get_player_slaver room_uuid="{room_uuid}"
                         out="{slaver}"/>
      <get_animal_list room_uuid="{room_uuid}"
                       player_uuid="{master}"
                       out="{master_animals}"/>
      <get_animal_list room_uuid="{room_uuid}"
                       player_uuid="{slaver}"
                       out="{slaver_animals}"/>
      <Sequence>
        <queue.foreach.uuid queue="{master_animals}"
                            value="{animal}"
                            pop_out="false"
                            if_empty="SUCCESS">
          <Sequence>
            <say.long msg="animal"
                      in="{animal}"/>
            <get_animal_type room_uuid="{room_uuid}"
                             player_uuid="{master}"
                             animal_uuid="{animal}"
                             out="{animal_type}"/>
            <say.animal_type msg="animal_type"
                             in="{animal_type}"/>
          </Sequence>
        </queue.foreach.uuid>
      </Sequence>
      <say.uuids msg="uuids"
                 in="{master_animals}"/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="get_animal_list">
      <input_port name="room_uuid"
                  default="{room_uuid}"/>
      <input_port name="player_uuid"/>
      <output_port name="out"/>
    </Action>
    <Action ID="get_animal_type">
      <input_port name="room_uuid"
                  default="{room_uuid}"/>
      <input_port name="player_uuid"/>
      <input_port name="animal_uuid"/>
      <output_port name="out"/>
    </Action>
    <Action ID="get_player_master">
      <input_port name="room_uuid"
                  default="{room_uuid}"/>
      <output_port name="out"/>
    </Action>
    <Action ID="get_player_slaver">
      <input_port name="room_uuid"
                  default="{room_uuid}"/>
      <output_port name="out"/>
    </Action>
    <Action ID="get_stage">
      <input_port name="room_uuid"
                  default="{room_uuid}"/>
      <output_port name="out"/>
    </Action>
    <Action ID="init.uuid">
      <output_port name="data"/>
    </Action>
    <Decorator ID="queue.foreach.uuid">
      <input_port name="queue"/>
      <output_port name="value"/>
      <input_port name="pop_out"
                  default="false"/>
      <input_port name="if_empty"
                  default="SUCCESS"/>
    </Decorator>
    <Action ID="say.animal_type">
      <input_port name="msg"/>
      <input_port name="in"/>
    </Action>
    <Action ID="say.long">
      <input_port name="msg"/>
      <input_port name="in"/>
    </Action>
    <Action ID="say.uuids">
      <input_port name="msg"/>
      <input_port name="in"/>
    </Action>
  </TreeNodesModel>

</root>
